# H5 It's Alive!

## Mikä on GNU-Debugger?

## Asennus
- `sudo apt-get install gdb`
<img width="528" height="41" alt="image" src="https://github.com/user-attachments/assets/f5131c2a-4c0a-4295-ba28-6e49917f02a7" />

## Lab 0
`wget https://terokarvinen.com/application-hacking/lab0.zip`
`cd Lataukset`
`unzip lab0.zip`

## a) Lab 1

Tarkoituksena tutkia ohjelmaa ja löytää vika, sitten korjata se.

- Aluksi unzippasin ladatun lab tehtävän `unzip lab1.zip` ja tutkin mitä tiedosto pitää sisällään

<img width="369" height="45" alt="image" src="https://github.com/user-attachments/assets/2333a7b4-df5a-4fd0-93bc-3d65b6142ed4" />

- Huomataan `gdb_example1` ohjelma, sekä sen C-kielinen tiedosto, sekä Makefile. Keskitytään nyt noihin kahteen `gdb_exampl1` tiedostoihin.
- Kokeilin ajaa ohjelman `./gdb_example1`, mutta se antoi virheilmoituksen "Muistialueen ylitys" & "Khoor/#zruog1". Huomataan ettei ohjelma toimi kunnolla. Aloitetaan GNU-debuggaus.
<img width="464" height="63" alt="image" src="https://github.com/user-attachments/assets/eb4f6e0f-1954-480d-be1e-d4705bd5be1c" />

- Käännetään ohjelma debuggausta varten `gcc -g -Wall -Wextra gdb_example1.c` -> `a.out` niminen tiedosto.
<img width="654" height="58" alt="image" src="https://github.com/user-attachments/assets/176eff05-1307-4062-8077-fb97f1f3596a" />

- Ajetaan tiedosto GNU-debuggerilla `gdb ./a.out` ja tutkitaan millainen ohjelma kyseessä `l` = "list"-komennolla
<img width="450" height="273" alt="image" src="https://github.com/user-attachments/assets/2b74a70a-2a4b-4dee-881b-abadf5153b73" />

- Huomataan´, rivi 14, jossa `char * bad_message =NULL;`, luulen että ohjelman vika johtuu kyseisestä muuttujasta. Kokeilaan ajaa ohjelmaa `r`-komennolla.
<img width="689" height="184" alt="image" src="https://github.com/user-attachments/assets/6073f4b4-5827-41b6-b57f-6616f545a1f6" />

- Ohjelma sai signaalin `SIGSEGV`, `Segmentation fault.`. Ohjelma kaatuu kohdassa `print_scrambled (message=0x0)`, joka näyttäytyy Null parametrina rivissä 7. 
- Tutkin asiaa netistä ja löysin selityksen signaalille. Ohjelma yrittää lukea tiettyä muistialuetta, johon sillä ei ole pääsyä tai sitä ei ole olemassa.
- Otin Text User Interface-tilan käyttöön `TUI enable`, jotta nähdään samanaikaisesti missä kohtaa ohjelmakoodia ollaan liikkumaassa, laitoin breakpointin riville 14, jossa `NULL` parametri on laadittuna. Sitten ajoin ohjelman GNU-debuggerissa `r`-komennolla ja ohjelma pysähtyy asettamaan breakpoint kohtaan.

<img width="735" height="482" alt="image" src="https://github.com/user-attachments/assets/52c7d148-4059-4502-8f5a-8074bcfb3e7e" />

- Käytin komentoa `n` = next liikkuakseni eteenpäni rivi riviltä. Parin askelluksen jälkeen ohjelma tulosti `Khoor/#zruog1`, eli ensimmäinen tulostus onnistui, mutta sen jälkeen ohjelma terminoituu SIGSEV, Segmentation faultin seurauksena. Huomataan, että rivin 17. jälkeen, ohjelma siirtyy `print_srambled(bad_message);` kohtaan ja ohjelmakoodissa bad_message on laadittu `char * bad_message = NULL;` eli `0x0` 

<img width="734" height="439" alt="image" src="https://github.com/user-attachments/assets/a8d074a6-f7bc-4146-b3e6-8912d9047d0f" />

- Asetin uuden breakpointin riviin 18 ja ajoin ohjelman uudelleen GNU-debuggerissa, nyt tässä breakpointissa astuin rivin sisälle `step` komennolla, sitten liikuin eteenpäin, kunnes SIGSEV ilmestyy ja katsoin backtrace komennolla `bt` syyt.
<img width="740" height="136" alt="image" src="https://github.com/user-attachments/assets/7b4ecad7-6ab7-4827-9c2d-1cb77019a9a1" />

- Backtrace näyttää, että kaatuminen tapahtuu funktiossa `print_scrambled` rivillä 7. Main funktio kutsuu tätä rivillä 18.

- Korjataan `Null` osoitin niin, että kirjoitetaan siihen vain jotain. Laitoin itse merkkijono "Fixaus" sitten tallensin tiedoston ja recompilesin sen `gcc -g -o korjattu? gdb_example1.c`

<img width="385" height="90" alt="image" src="https://github.com/user-attachments/assets/4acd43dc-8074-4745-a32e-83ac33e42c4f" />

<img width="724" height="147" alt="image" src="https://github.com/user-attachments/assets/737b2e71-37db-43c6-90aa-12eb22a816b0" />

<img width="454" height="59" alt="image" src="https://github.com/user-attachments/assets/47c9cf48-1822-415e-a269-b3c168f09065" />

- Ohjelma palauttaa oudolta näyttävän merkkijonon, sillä se siirtää määritellyn merkkijono jokaista kirjainta 3. merkkiä eteenpäin eli ASCII-arvoa 3. eteenpäin. Huomataan koodin kohdasta:

<img width="316" height="120" alt="image" src="https://github.com/user-attachments/assets/515f43b9-50ae-4067-b222-1df71a1edeb9" />












# Lähteet:
- https://www.youtube.com/watch?v=1RrGVHF97Gs
