# H4-tasks.
## x) Hammond 2022: https://www.youtube.com/watch?v=oTD_ki86c9I
- John Hammond kertoo Ghidrasta ja käyttää sitä Pico CTF 2022 tehtävän ratkaisuun.
- Ghidra on NSA:n kehittämä avoimen lähdekoodin takaisinmallinnustyökalu, jota käytetään pakattujen binäärien tutkimiseen ja analysointiin.
- Ghidra muuttaa binääritiedostoja luettavampaan muotoon.
- Ghidran avulla voidaan selittää ja selvittää ohjelmistojen toiminnallisuuksia.
- Videossa Hammond löytää hexadesimaaliarvon Ghidran analysoimasta binääritiedostosta ja kääntää sen pythonilla desimaaleiksi, mikä onkin tehtävän ratkaisu!

## a) Installing ghidra
- Ladataan Ghidra virtuaalikoneelle.
- Aluksi latasin Ghidra 12.0.2.zip tiedoston osoitteesta `wget https://github.com/NationalSecurityAgency/ghidra/releases/tag/Ghidra_12.0.2_build`
- VM:ssäni ei ollut Javaa, joten asensin sen `sudo apt install -y openjdk-21-jdk`
- Sitten unzippasin ladatun Ghidra zip-tiedoston `unzip ghidra_12.0.2...`
- Suuntasin Ghidran hakemistoon ja ajoin `./ghidraRun`
- <img width="682" height="61" alt="image" src="https://github.com/user-attachments/assets/26ea9b55-3d60-4efb-b1e1-93faa42dc08a" />
- <img width="724" height="41" alt="image" src="https://github.com/user-attachments/assets/a91f67f3-47d7-46e5-b596-30f2a03774af" />
- <img width="1056" height="479" alt="image" src="https://github.com/user-attachments/assets/846a8dfb-0666-4710-8648-8ed9225e3d75" />
- <img width="498" height="467" alt="image" src="https://github.com/user-attachments/assets/3a0aab41-d164-4998-9bd7-8eb1e3e43eaa" />

## b) rever-C
Tässä tehtävässä tulee takaisinmallintaa (reverse engineer) `packd` binääritiedostot C-kieleksi ja analysoida, sekä kertoa ohjelman toiminnallisuus.
<img width="800" height="769" alt="image" src="https://github.com/user-attachments/assets/af124f35-c83f-420a-a4ee-6c3137ad166f" />

- Avataan `packd` Ghidrassa

<img width="801" height="595" alt="image" src="https://github.com/user-attachments/assets/4a5ca2c3-35f4-492f-a00d-b0d99cbfab40" />

- Suoritetaan automaattinen analyysi tiedostolle, jotta voidaan aloittaa ohjelman tutkiminen ja saadaan binääreistä selkokielisempiä.
<img width="526" height="153" alt="image" src="https://github.com/user-attachments/assets/7edeb420-cb0b-4da4-9f42-d11e13a6afd1" />
- Etsitään `main` function. Löysin tämän kohdasta `symbol tree` -> `functions` -> `main`. Klikkaamalla pinkkiä `main`-funktiota saadaan avattua se Ghidrassa `Decompile` näkymässä, josta selviää C-kielinen ohjelma.
<img width="1299" height="165" alt="image" src="https://github.com/user-attachments/assets/b0a95ed6-8385-4605-b0d3-42ae79b8fa44" />
<img width="542" height="501" alt="image" src="https://github.com/user-attachments/assets/e83c907e-1b77-4c41-99da-90b2a70faf3b" />
- Huomataan, että koodissa on määriteltyjä muuttujia, selvitetään mikä ohjelman idea on.
- Ohjelma on yksinkertainen salasanantarkastaja. Kun ohjelman ajaa, se kysyy salasanaa käyttäjältä -> Käyttäjä syöttää salasanan -> Ohjelma vertaa käyttäjän syötettä oikeaan salasanaan -> `strcmp` palauttaa `0`, mikäli syötetyt merkkijonot ovat täysin samat -> Jos oikein tulostuu "Yes! That's the password. Flag...", jos taas väärin tulostuu "Sorry, no bonus".
<img width="635" height="311" alt="image" src="https://github.com/user-attachments/assets/8079301b-79ec-4603-8698-65b4422798dc" />
- Vaihdoin `int` muuttujan nimeksi `passwordMatches` ja `char` `passwd`

## c) If backwards.
Tässä tehtävässä muutetaan tiedostoa `passtr` niin, että se hyväksyy kaikki salasanat paitsi oikean.

- Avataan `passtr` Ghidrassa ja suoritetaan automaattinen analysointi
<img width="493" height="217" alt="image" src="https://github.com/user-attachments/assets/be9cf40c-8eb2-4f36-90a7-34eaf2cbeb02" />
- Etsin main funktion kohdan ja vilkaisin sen decompile-näkymää
<img width="639" height="329" alt="image" src="https://github.com/user-attachments/assets/0b0bdf30-7f67-470d-9f1c-85f789f5b33c" />
- Nyt ohjelma hyväksyy vain oikean salasanan (palauttaa 0, jos salasana on oikein), minun täytyy selvittää miten käännän ohjelman halutuksi "väärän" salasanan hyväksyjäksi

<img width="574" height="19" alt="image" src="https://github.com/user-attachments/assets/6c526345-dc5b-4ea1-a28e-35a4289db7c5" />

- Tutkin koodia pitkään ja huomasin ehtohypyt koodissa "JNZ", joka tarkoittaa "Jump If Not Zero", eli ohjelmakoodi hyppää haluttuun kohtaan, jos tulos ei ole nolla. Etsin netistä tietoa ja löysin täydellisen ratkaisun (https://medium.com/@anandrishav2228/reverse-engineering-for-beginner-0bf9b20542f7)
  
- Muutin ehtohypyn `JNZ` -> `JZ`, eli Jump to Zero. Nyt ohjelma koodi hyppää suoraan haluttuun kohtaan, kun tulos on 0. Nyt ohjelma toimii niin, että väärä salasana ei hyppää error-kohtaan. Tällöin hyväksyntäkohta toimii kaikilla muilla syötteillä paitsi sillä oikealla salasanalla.

- Lopulta exporttasin ohjelman `Original File`:nä, ajoin terminaalissa `chmod +x passtrpatched`, jotta luodaan ohjelmasta ajettava

- Kokeillaan toimiiko!

<img width="660" height="199" alt="image" src="https://github.com/user-attachments/assets/023b3a3d-826f-4933-b1d6-cb8dc9c03075" />

- Toimii! Väärä salasana palauttaa Flägin ja hyväksyy salasanan.

## d) Nora crackme01
Tässä tehtävässä tullaan kääntämään tiedostoja binääreiksi ja sen avulla pyritään selvittämään ratkaisut.

- Aluksi kloonasin github repon `git clone https://github.com/NoraCodes/crackmes` ja siirryin `crackmes` hakemistoon
<img width="736" height="275" alt="image" src="https://github.com/user-attachments/assets/efdebf4c-ca1d-42d1-9c8a-a1216f8ed7ac" />

- Katsoin ERADME.md tiedoston `cat README.md`
- Tiedostot olivat alkuun C-tiedostoja, näistä tuli kääntää binääritiedostoja
- Asensin virtuaalikoneelleni työkaluja, joilla pystyn kääntämään binääritiedostoja `sudo apt install -y build-essential make`
- Loin jokaisesta `crackmes` hakemiston kansiosta binääritiedostot `make crackme01`...

<img width="827" height="329" alt="image" src="https://github.com/user-attachments/assets/f3c1bd94-9b1d-407c-a0b1-1e5e8446372e" />


<img width="402" height="23" alt="image" src="https://github.com/user-attachments/assets/9f38e137-4959-4d1f-940a-ab905b9e939b" />

<img width="833" height="146" alt="image" src="https://github.com/user-attachments/assets/c0ed2dc6-ceb1-4695-ba72-cb89e7e2d392" />

Nyt tiedostot ovat ajettavia binääritiedostoja (vihreät)

e) Crackme01

- Crackme tiedostot ovat pieniä tehtäviä, joihin tulee etsiä oikea syöte (salasana)
- Tässä tehtävässä katsoin aluksi `strings crackme01.64`, selasin luettavia binäärejä ja huomasin heti "password1"
- Kokeilin ajaa ohjelman `./crackme01.64 password1` ja se toimi!

<img width="439" height="113" alt="image" src="https://github.com/user-attachments/assets/d3ca1489-3ea4-480d-9406-ed9a2e48eae2" />

<img width="533" height="44" alt="image" src="https://github.com/user-attachments/assets/a76a3ada-3a95-444f-9ae7-43cb71036bbc" />

e) Crackme01e
- Tässä samantyylinen, katsotaan ensiksi `strings crackme01e`
- Huomataan `slm!paas.k` -> kokeillaan toimiiko, ei toiminut :/.
<img width="266" height="90" alt="image" src="https://github.com/user-attachments/assets/9e112ac1-c0c4-42a1-b798-17d9bfcdc980" />

<img width="546" height="58" alt="image" src="https://github.com/user-attachments/assets/9a36cd5c-02e5-407b-ab7d-4f41e6438d95" />

- Kokeilin argumenteiksi `slm\!paask.k`, sekä `slm!paas.k`, ne toimivat
- Bash-kielessä `!` tarkoittaa history-expansionia, tässä tilanteessa, kun huutomerkin muuttaa `´\`-merkiksi kertoo se ohjelmalle, että tämä ottaa seuraavan merkin kirjaimellisesti. Tehtiin ns. escapetus, joka mahdollistaa että binääri saa tarvittavan merkkijonon ja vertailu toimii. Lähteenä käytin apuna tässä tehtävässä (https://www.gnu.org/software/bash/manual/html_node/History-Interaction.html) 

<img width="537" height="39" alt="image" src="https://github.com/user-attachments/assets/e3591012-28d5-469e-b6ca-293a8e99c8d6" />

<img width="595" height="38" alt="image" src="https://github.com/user-attachments/assets/4bd0cec5-b22d-433b-8482-3e836f383ae4" />

f) Crackme02.
Nimeä pääohjelman muuttujat uudelleenmuunnetusta binääristä ja selitä ohjelman toiminnallisuus

- Avasin `crackme02.64` Ghidrassa ja tarkastelin decompile ikkunaa
- Ohjelma vaatii yhden argumentin eli tietyn salasanan ja vertaa sitä merkkijonoon `password1`, tässä ohjelman toiminnossa ennen vertailua käyttäjän syötteeseen ohjelma vähentää kaikista merkeistä yhden ja vertailee syötteen merkkiä kovakoodattuun merkkijonoon. Jos oikein ohjelma palauttaa 0, jos merkkijono ei täsmää ohjelma palauttaa virhekoodin.
- Ohjelma saadaan ratkottua oikealla salasanalla, joten rupesin tutkimaan Ghidra koodia. Löysin `password1`, `assword1`, `ssword1`salasanoihin viittaavia merkkijonoja.

<img width="697" height="505" alt="image" src="https://github.com/user-attachments/assets/c2bd0b6a-0d4b-4d8b-a0a2-49c24b441bb7" />

<img width="695" height="317" alt="image" src="https://github.com/user-attachments/assets/80f06c1d-4f4f-4d2f-a914-36b0ba413c5a" />

- Päätin kokeilla seuraavia salasanoja, mutta ei onnistunut

<img width="576" height="361" alt="image" src="https://github.com/user-attachments/assets/dbb9227c-45e2-4d84-a9ba-d7ce9387d111" />
 
- Mietitään, jos ohjelma kääntää salasanan ASCII-merkkejä, vähentämällä jokaisesta merkistä yhden. Voisiko salasanaa `password1` käydä muuttamassa?
- Etsin netistä apua "ASCII decoder" ja löysin ASCII Shift Decoder työkalun, jonka avulla voidaan siirtää ASCII-koodia tietyin määrin ylös ja alas
- Kokeilin siellä muuttaa merkkijonoa "password1" ja katsoin tuloksia

- <img width="811" height="201" alt="image" src="https://github.com/user-attachments/assets/7cc96179-3347-4426-97ae-29e114cfa3aa" />

- Huomataan että siirtämällä merkkejä "+1" arvon verran saadaan merkkijonoksi tuon näköinen merkkijono
- Kokeillaan sitä.

<img width="556" height="112" alt="image" src="https://github.com/user-attachments/assets/b9564d9e-1ec3-4556-882a-83e47d18e876" />

- Onnistui!

## Läheet:

https://medium.com/@anandrishav2228/reverse-engineering-for-beginner-0bf9b20542f7

https://nora.codes/tutorial/an-intro-to-x86_64-reverse-engineering/

https://terokarvinen.com/application-hacking/#h4-some-disassembly-required-tero

https://www.youtube.com/watch?v=oTD_ki86c9I

https://github.com/NoraCodes/crackmes

https://www.gnu.org/software/bash/manual/html_node/History-Interaction.html











